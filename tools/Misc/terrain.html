<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <title>Fertility vs Education vs Density (Grouped Toggle)</title>
</head>
<body>
    <div id="plot" style="width:100%;height:90vh;"></div>
    <script>
        var data = [
            // Fertility (legendgroup 'Fertility')
            {x:[1979,1980,1985,1990,1995], y:[6.3,6.1,5.5,4.8,3.9], mode:'lines+markers', name:'Iran Fertility', line:{width:2}, legendgroup:'Fertility'},
            {x:[1945,1950,1955,1960,1965], y:[2.0,3.0,3.7,3.6,3.2], mode:'lines+markers', name:'US Fertility', line:{width:2}, legendgroup:'Fertility'},
            {x:[1945,1950,1955,1960,1965], y:[2.0,2.5,2.9,2.8,2.4], mode:'lines+markers', name:'Germany Fertility', line:{width:2}, legendgroup:'Fertility'},
            {x:[1970,1975,1980,1985,1990], y:[6.5,6.2,5.8,5.3,4.7], mode:'lines+markers', name:'Bangladesh Fertility', line:{width:2}, legendgroup:'Fertility'},
            {x:[1960,1965,1970,1975,1980], y:[6.5,6.6,6.5,6.4,6.3], mode:'lines+markers', name:'Nigeria Fertility', line:{width:2}, legendgroup:'Fertility'},

            // Density (legendgroup 'Density')
            {x:[1979,1980,1985,1990,1995], y:[40,41,43,45,47], mode:'lines', name:'Iran Density', line:{dash:'dash'}, yaxis:'y2', legendgroup:'Density'},
            {x:[1945,1950,1955,1960,1965], y:[32,33,34,35,36], mode:'lines', name:'US Density', line:{dash:'dash'}, yaxis:'y2', legendgroup:'Density'},
            {x:[1945,1950,1955,1960,1965], y:[27,28,29,30,31], mode:'lines', name:'Germany Density', line:{dash:'dash'}, yaxis:'y2', legendgroup:'Density'},
            {x:[1970,1975,1980,1985,1990], y:[450,460,470,480,490], mode:'lines', name:'Bangladesh Density', line:{dash:'dash'}, yaxis:'y2', legendgroup:'Density'},
            {x:[1960,1965,1970,1975,1980], y:[50,52,54,56,58], mode:'lines', name:'Nigeria Density', line:{dash:'dash'}, yaxis:'y2', legendgroup:'Density'},

            // Female Education (legendgroup 'Education')
            {x:[1979,1980,1985,1990,1995], y:[2.1,2.1,2.2,2.3,2.5], mode:'lines', name:'Iran Female Edu', line:{dash:'dot'}, yaxis:'y2', legendgroup:'Education'},
            {x:[1945,1950,1955,1960,1965], y:[8.5,8.7,8.9,9.0,9.2], mode:'lines', name:'US Female Edu', line:{dash:'dot'}, yaxis:'y2', legendgroup:'Education'},
            {x:[1945,1950,1955,1960,1965], y:[7.0,7.2,7.5,7.8,8.0], mode:'lines', name:'Germany Female Edu', line:{dash:'dot'}, yaxis:'y2', legendgroup:'Education'},
            {x:[1970,1975,1980,1985,1990], y:[1.0,1.1,1.2,1.3,1.5], mode:'lines', name:'Bangladesh Female Edu', line:{dash:'dot'}, yaxis:'y2', legendgroup:'Education'},
            {x:[1960,1965,1970,1975,1980], y:[1.5,1.7,1.9,2.0,2.2], mode:'lines', name:'Nigeria Female Edu', line:{dash:'dot'}, yaxis:'y2', legendgroup:'Education'}
        ];

        var layout = {
            title: 'Fertility vs Female Education vs Density (Grouped Toggle per Variable)',
            xaxis: {title:'Year'},
            yaxis: {title:'Total Fertility Rate (TFR)'},
            yaxis2: {title:'Density / Female Education', overlaying:'y', side:'right'},
            hovermode:'x unified',
            shapes:[
                {type:'rect', x0:1979, x1:1995, y0:0, y1:10, fillcolor:'gray', opacity:0.1, layer:'below', line:{width:0}},
                {type:'rect', x0:1945, x1:1965, y0:0, y1:10, fillcolor:'gray', opacity:0.1, layer:'below', line:{width:0}},
                {type:'rect', x0:1970, x1:1990, y0:0, y1:10, fillcolor:'gray', opacity:0.1, layer:'below', line:{width:0}},
                {type:'rect', x0:1960, x1:1980, y0:0, y1:10, fillcolor:'gray', opacity:0.1, layer:'below', line:{width:0}}
            ],
            annotations:[
                {x:1987, y:6.5, text:'Fertility ↓ despite low education', showarrow:false, font:{color:'red', size:12}, xanchor:'center'},
                {x:1955, y:4.0, text:'Baby boom ↑ fertility despite rising education', showarrow:false, font:{color:'blue', size:12}, xanchor:'center'},
                {x:1980, y:6.0, text:'Fertility ↓ before female education ↑', showarrow:false, font:{color:'green', size:12}, xanchor:'center'},
                {x:1970, y:6.5, text:'Fertility remained high despite education ↑', showarrow:false, font:{color:'orange', size:12}, xanchor:'center'}
            ],
            legend: {itemclick:'toggle', itemdoubleclick:'toggleothers'}
        };

        Plotly.newPlot('plot', data, layout, {responsive:true});
    </script>
</body>
</html>