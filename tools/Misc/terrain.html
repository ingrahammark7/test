<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dogfight Simulator</title>
  <style>
    html, body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>

<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB); // Sky blue

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
camera.position.z = 100;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(100, 200, 100);
scene.add(light);

// Ground
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(10000, 10000),
  new THREE.MeshPhongMaterial({ color: 0x228B22 })
);
ground.rotation.x = -Math.PI / 2;
ground.position.y = -50;
scene.add(ground);

// Plane geometry
function createFighter(color) {
  const group = new THREE.Group();

  const body = new THREE.Mesh(
    new THREE.CylinderGeometry(2, 2, 20, 8),
    new THREE.MeshPhongMaterial({ color })
  );
  body.rotation.z = Math.PI / 2;
  group.add(body);

  const wing = new THREE.Mesh(
    new THREE.BoxGeometry(15, 1, 2),
    new THREE.MeshPhongMaterial({ color: 0x333333 })
  );
  wing.position.set(0, 0, 2);
  group.add(wing);

  return group;
}

// Fighters
const fighters = [];
const numFighters = 8;
for (let i = 0; i < numFighters; i++) {
  const fighter = createFighter(i % 2 === 0 ? 0xff0000 : 0x0000ff);
  fighter.position.set(Math.random() * 300 - 150, Math.random() * 200, Math.random() * 300 - 150);
  fighter.userData = {
    velocity: new THREE.Vector3(Math.random() - 0.5, Math.random() - 0.2, Math.random() - 0.5).normalize().multiplyScalar(2),
    target: null
  };
  scene.add(fighter);
  fighters.push(fighter);
}

// Camera follow
let camTarget = fighters[0];

// Animation
function animate() {
  requestAnimationFrame(animate);

  for (let i = 0; i < fighters.length; i++) {
    const f = fighters[i];
    if (!f.userData.target || Math.random() < 0.01) {
      f.userData.target = fighters[Math.floor(Math.random() * fighters.length)];
    }
    const target = f.userData.target;
    if (target && target !== f) {
      const dir = new THREE.Vector3().subVectors(target.position, f.position).normalize();
      f.userData.velocity.lerp(dir.multiplyScalar(2), 0.02); // Homing
    }
    f.position.add(f.userData.velocity);
    f.lookAt(f.position.clone().add(f.userData.velocity));

    // bounce if too far
    ['x', 'y', 'z'].forEach(axis => {
      if (Math.abs(f.position[axis]) > 500) f.userData.velocity[axis] *= -1;
    });
  }

  // Camera trailing view
  if (camTarget) {
    const offset = camTarget.userData.velocity.clone().normalize().multiplyScalar(-30).add(new THREE.Vector3(0, 10, 0));
    camera.position.lerp(camTarget.position.clone().add(offset), 0.05);
    camera.lookAt(camTarget.position);
  }

  renderer.render(scene, camera);
}

animate();
</script>
</body>
</html>