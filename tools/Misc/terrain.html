<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Engine Mass Animation - Full Features</title>
<style>
  body { margin:0; overflow:hidden; background:#222; }
  canvas { display:block; }
  #info {
    position:absolute; top:10px; left:10px;
    color:white; font-family:sans-serif;
    background:rgba(0,0,0,0.5); padding:5px 10px;
    border-radius:5px; pointer-events:none;
  }
</style>
</head>
<body>
<div id="info">Hover over a bar</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
  // -------------------- Scene Setup --------------------
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x222222);

  const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 2000);
  camera.position.set(0, 15, 30);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // -------------------- Lights --------------------
  const dirLight = new THREE.DirectionalLight(0xffffff, 1);
  dirLight.position.set(20,40,20);
  dirLight.castShadow = true;
  dirLight.shadow.mapSize.width = 2048;
  dirLight.shadow.mapSize.height = 2048;
  scene.add(dirLight);

  scene.add(new THREE.AmbientLight(0x404040,1.5));
  scene.add(new THREE.HemisphereLight(0x444444,0x222222,0.5));

  // Ground for shadows
  const groundGeo = new THREE.PlaneGeometry(200,200);
  const groundMat = new THREE.ShadowMaterial({opacity:0.3});
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI/2;
  ground.receiveShadow = true;
  scene.add(ground);

  // -------------------- Data --------------------
  const factors = [
    {name:"gethc * 8", value:625},
    {name:"* 8", value:5002},
    {name:"* phi", value:8094},
    {name:"/ tensile", value:0.0367},
    {name:"(fden*fen)^(1/3)", value:3384},
    {name:"* vp", value:40611},
    {name:"Final Mass", value:1488}
  ];

  const maxVal = Math.max(...factors.map(f=>f.value));
  const bars = [];
  const spacing = 3;
  const info = document.getElementById('info');

  // -------------------- Bar Creation --------------------
  factors.forEach((f,i)=>{
    const h = 0.1;
    const geometry = new THREE.BoxGeometry(1,h,1);
    const color = new THREE.Color().setHSL(0.6*(f.value/maxVal),0.7,0.5);
    const material = new THREE.MeshPhongMaterial({color:color});
    const bar = new THREE.Mesh(geometry,material);
    bar.castShadow = true;
    bar.receiveShadow = true;
    bar.position.set(i*spacing - factors.length*spacing/2, h/2, 0);
    bar.userData = {
      targetHeight: f.value/maxVal*10,
      name: f.name,
      value: f.value,
      baseColor: color.clone()
    };
    scene.add(bar);
    bars.push(bar);

    // Label
    const canvas = document.createElement('canvas');
    canvas.width=256; canvas.height=64;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle='white';
    ctx.font='28px sans-serif';
    ctx.textAlign='center';
    ctx.fillText(`${f.name}: ${f.value}`,128,40);
    const texture = new THREE.CanvasTexture(canvas);
    const spriteMat = new THREE.SpriteMaterial({map:texture,transparent:true});
    const sprite = new THREE.Sprite(spriteMat);
    sprite.scale.set(4,1,1);
    sprite.position.set(bar.position.x, bar.userData.targetHeight+1, bar.position.z);
    scene.add(sprite);
  });

  // -------------------- Interaction --------------------
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  window.addEventListener('mousemove',(event)=>{
    mouse.x = (event.clientX/window.innerWidth)*2-1;
    mouse.y = -(event.clientY/window.innerHeight)*2+1;
  });

  window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // -------------------- Animation Loop --------------------
  function animate(){
    requestAnimationFrame(animate);
    const time = Date.now()*0.001;

    // Camera auto-rotation
    camera.position.x = Math.sin(time*0.2)*30;
    camera.position.z = Math.cos(time*0.2)*30;
    camera.lookAt(0,5,0);

    // Raycast for hover
    raycaster.setFromCamera(mouse,camera);
    const intersects = raycaster.intersectObjects(bars);
    if(intersects.length>0){
      const hovered = intersects[0].object;
      hovered.material.color.set(0xff0000);
      info.textContent = `${hovered.userData.name}: ${hovered.userData.value}`;
    } else {
      info.textContent = 'Hover over a bar';
    }

    // Bar growth animation + easing
    bars.forEach(bar=>{
      const target = bar.userData.targetHeight;
      bar.scale.y += (target - bar.scale.y)*0.05; // easing
      bar.position.y = bar.scale.y/2;
      // reset color if not hovered
      if(!intersects.includes(bar)) bar.material.color.copy(bar.userData.baseColor);
    });

    renderer.render(scene,camera);
  }

  animate();
</script>
</body>
</html>